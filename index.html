<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Matrix of Lights – Endpoint Dashboard</title>
  <style>
    /* Global Styles */
    body { 
      font-family: Menlo, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background-color: #fbfbfb;
      color: #333;
      line-height: 1.6;
    }
    h1 { 
      text-align: center; 
      margin-bottom: 20px; 
      font-weight: 300;
    }
    p.subtitle {
      text-align: center;
      font-size: 15px;
      color: #555;
      margin-bottom: 20px;
    }
    
    /* Matrix Grid */
    .matrix {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      max-width: 800px;
      margin: 0 auto 30px;
    }
    .matrix-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background-color: #bbb; /* initial color = unknown */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: box-shadow 0.3s ease;
    }
    .matrix-item:hover::after {
      content: attr(data-label);
      position: absolute;
      bottom: -24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.75);
      color: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
      white-space: nowrap;
    }
    
    /* Status animations */
    .up {
      background-color: #27ae60 !important;
      animation: breathing 2s infinite;
    }
    .down {
      background-color: #e74c3c !important;
    }
    @keyframes breathing {
      0% { box-shadow: 0 0 5px 2px rgba(39, 174, 96, 0.7); }
      50% { box-shadow: 0 0 15px 4px rgba(39, 174, 96, 1); }
      100% { box-shadow: 0 0 5px 2px rgba(39, 174, 96, 0.7); }
    }
    
    /* Cheatsheet */
    #cheatsheet {
      max-width: 800px;
      margin: 0 auto;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      font-size: 14px;
      color: #333;
    }
    #cheatsheet h2 {
      margin-top: 0;
      font-weight: 400;
      color: #2c3e50;
    }
    #cheatsheet ul {
      list-style-type: disc;
      padding-left: 20px;
    }
    code {
      background: #f0f0f0;
      padding: 2px 4px;
      border-radius: 2px;
    }
    
    /* Refresh timestamp */
    .refresh-timestamp {
      text-align: center;
      font-size: 0.9em;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Matrix of Lights – Endpoint Dashboard</h1>
  <p class="subtitle">Click on a light to open the service. Hover for details.</p>
  
  <div class="matrix" id="matrix"></div>
  
  <div class="refresh-timestamp" id="lastRefreshed">Last refreshed: --</div>
  
  <section id="cheatsheet">
    <h2>Cheatsheet & Manual Inspection Tips</h2>
    <ul>
      <li>Inspect a service: <code>curl -I &lt;endpoint&gt;</code></li>
      <li>DNS lookup: <code>nslookup &lt;domain&gt;</code></li>
      <li>Monitor logs: <code>tail -f /var/log/nginx/access.log</code></li>
      <li>Versioning: <code>git commit -am "Update endpoints"</code> and push your changes.</li>
    </ul>
  </section>
  
  <script>
    // Sample endpoints data with various ports.
    const endpoints = [
      { label: 'api.dissemblage.art (443)', url: 'https://api.dissemblage.art', port: 443 },
      { label: 'ollama.dissemblage.art (443)', url: 'https://ollama.dissemblage.art', port: 443 },
      { label: 'homeserver.hyperstitious.org (443)', url: 'https://homeserver.hyperstitious.org', port: 443 },
      { label: 'portfolio.cyrillrafael.org (443)', url: 'https://portfolio.cyrillrafael.org', port: 443 },
      { label: 'void.marchdown.net (80)', url: 'http://void.marchdown.net', port: 80 },
      { label: 'blog.dissemblage.art (80)', url: 'http://blog.dissemblage.art', port: 80 },
      { label: 'studio.dissemblage.art (8080)', url: 'http://studio.dissemblage.art', port: 8080 },
      { label: 'dev.hyperstitious.org (3000)', url: 'http://dev.hyperstitious.org', port: 3000 },
      { label: 'api.cyrillrafael.org (5000)', url: 'http://api.cyrillrafael.org', port: 5000 },
      { label: 'market.marchdown.net (7777)', url: 'http://market.marchdown.net', port: 7777 },
      { label: 'test.dissemblage.art (5050)', url: 'http://test.dissemblage.art', port: 5050 },
      { label: 'dashboard.cyrillrafael.org (7000)', url: 'http://dashboard.cyrillrafael.org', port: 7000 }
    ];
    
    // Create a container reference.
    const matrixContainer = document.getElementById('matrix');
    
    // Create a light (matrix item) for each endpoint.
    endpoints.forEach((ep, index) => {
      const item = document.createElement('div');
      item.className = 'matrix-item';
      // Use data attributes to store label, port, and URL (for tooltip and on click).
      item.setAttribute('data-label', `${ep.label}`);
      item.setAttribute('data-url', ep.url);
      // When clicked, open the service in a new window.
      item.addEventListener('click', () => {
        window.open(ep.url, '_blank');
      });
      // Insert a short label (or index) for visual reference.
      item.textContent = index + 1;
      matrixContainer.appendChild(item);
      // Save a reference for later status updates.
      ep._element = item;
    });
    
    // Function to ping an endpoint using HEAD (with a timeout).
    async function pingEndpoint(url, timeout = 5000) {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), timeout);
      const start = performance.now();
      try {
        const response = await fetch(url, { method: 'HEAD', signal: controller.signal });
        clearTimeout(timeoutId);
        const duration = Math.round(performance.now() - start);
        if (response.ok) {
          return { status: 'up', responseTime: duration, statusCode: response.status };
        } else {
          return { status: 'down', responseTime: 'N/A', statusCode: response.status, error: `HTTP ${response.status}` };
        }
      } catch (error) {
        clearTimeout(timeoutId);
        return { status: 'down', responseTime: 'N/A', statusCode: 'N/A', error: error.name === 'AbortError' ? 'Timeout' : error.message };
      }
    }
    
    // Refresh the status of all endpoints and update the lights.
    async function refreshMatrix() {
      for (const ep of endpoints) {
        const result = await pingEndpoint(ep.url);
        // Update the light: add class "up" if service is up, otherwise "down".
        if (result.status === 'up') {
          ep._element.classList.remove('down');
          ep._element.classList.add('up');
        } else {
          ep._element.classList.remove('up');
          ep._element.classList.add('down');
        }
      }
      document.getElementById('lastRefreshed').textContent = 'Last refreshed: ' + new Date().toLocaleString();
    }
    
    // Refresh every 2 minutes (or adjust as needed)
    setInterval(refreshMatrix, 2 * 60 * 1000);
    // Initial refresh.
    refreshMatrix();
  </script>
</body>
</html>
