<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Multi-Domain Endpoint Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Modern CSS Variables & Design System */
    :root {
      --primary-500: #3b82f6;
      --primary-600: #2563eb;
      --primary-700: #1d4ed8;
      --secondary-500: #6366f1;
      --secondary-600: #4f46e5;
      --success-500: #10b981;
      --success-600: #059669;
      --warning-500: #f59e0b;
      --warning-600: #d97706;
      --error-500: #ef4444;
      --error-600: #dc2626;
      
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      
      --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --bg-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --bg-surface: rgba(255, 255, 255, 0.95);
      --bg-surface-dark: rgba(15, 23, 42, 0.95);
      --bg-glass: rgba(255, 255, 255, 0.1);
      --bg-glass-dark: rgba(15, 23, 42, 0.8);
      
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      
      --border-radius-sm: 0.375rem;
      --border-radius-md: 0.5rem;
      --border-radius-lg: 0.75rem;
      --border-radius-xl: 1rem;
      
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-2xl: 3rem;
      
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--gray-800);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: auto;
    }

    /* Header */
    .header {
      background: var(--bg-glass);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: var(--spacing-lg) var(--spacing-xl);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-lg);
    }

    .header-title {
      font-size: 1.875rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header-controls {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
    }

    .control-group {
      display: flex;
      background: var(--bg-glass);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-xs);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .control-btn {
      background: transparent;
      border: none;
      color: white;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .control-btn.active {
      background: var(--primary-500);
      color: white;
    }

    /* Main Dashboard Layout */
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--spacing-xl);
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: var(--spacing-xl);
      min-height: calc(100vh - 120px);
    }

    .main-content {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    /* Network Topology Visualization */
    .topology-container {
      background: var(--bg-surface);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-lg);
      padding: var(--spacing-lg);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .topology-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .topology-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--gray-800);
    }

    .topology-canvas {
      width: 100%;
      height: 400px;
      border-radius: var(--border-radius-lg);
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      position: relative;
      overflow: hidden;
    }

    /* Domain Sections */
    .domains-grid {
      display: grid;
      gap: var(--spacing-lg);
    }

    .domain-section {
      background: var(--bg-surface);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      overflow: hidden;
      transition: var(--transition-normal);
    }

    .domain-section:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .domain-header {
      background: linear-gradient(135deg, var(--primary-500) 0%, var(--secondary-500) 100%);
      color: white;
      padding: var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .domain-title {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .domain-meta {
      font-size: 0.875rem;
      opacity: 0.9;
    }

    .domain-toggle {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .domain-toggle:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .domain-content {
      padding: var(--spacing-lg);
      display: none;
    }

    .domain-content.expanded {
      display: block;
    }

    .domain-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--gray-50);
      border-radius: var(--border-radius-md);
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .info-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray-500);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .info-value {
      font-size: 0.875rem;
      color: var(--gray-700);
    }

    /* Services Grid */
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-md);
    }

    .service-card {
      background: white;
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--gray-200);
      transition: var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .service-card:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .service-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--status-color, var(--gray-300));
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-md);
    }

    .service-title {
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: var(--spacing-xs);
    }

    .service-url {
      font-size: 0.875rem;
      color: var(--primary-500);
      text-decoration: none;
      word-break: break-all;
    }

    .service-url:hover {
      text-decoration: underline;
    }

    .service-status {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 0.875rem;
      font-weight: 600;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--border-radius-sm);
    }

    .service-status.up {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success-600);
    }

    .service-status.down {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error-600);
    }

    .service-status.pending {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning-600);
    }

    .service-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .metric {
      text-align: center;
    }

    .metric-value {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--gray-800);
    }

    .metric-label {
      font-size: 0.75rem;
      color: var(--gray-500);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .service-actions {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
    }

    .action-btn {
      flex: 1;
      background: var(--gray-100);
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
      padding: var(--spacing-sm);
      border-radius: var(--border-radius-md);
      font-size: 0.875rem;
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
    }

    .action-btn:hover {
      background: var(--gray-200);
    }

    .action-btn.primary {
      background: var(--primary-500);
      color: white;
      border-color: var(--primary-500);
    }

    .action-btn.primary:hover {
      background: var(--primary-600);
    }

    /* Sparkline Chart */
    .sparkline-container {
      height: 40px;
      width: 100%;
      margin: var(--spacing-sm) 0;
    }

    .sparkline {
      width: 100%;
      height: 100%;
    }

    /* Sidebar Panels */
    .sidebar-panel {
      background: var(--bg-surface);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      overflow: hidden;
    }

    .sidebar-header {
      background: linear-gradient(135deg, var(--secondary-500) 0%, var(--primary-500) 100%);
      color: white;
      padding: var(--spacing-lg);
      font-weight: 600;
    }

    .sidebar-content {
      padding: var(--spacing-lg);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .stat-card {
      background: white;
      padding: var(--spacing-md);
      border-radius: var(--border-radius-lg);
      text-align: center;
      box-shadow: var(--shadow-sm);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-800);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--gray-500);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Quick Actions */
    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .quick-action {
      background: white;
      border: 1px solid var(--gray-200);
      padding: var(--spacing-md);
      border-radius: var(--border-radius-lg);
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .quick-action:hover {
      background: var(--gray-50);
      border-color: var(--primary-300);
    }

    .quick-action-icon {
      width: 40px;
      height: 40px;
      background: var(--primary-500);
      color: white;
      border-radius: var(--border-radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quick-action-content {
      flex: 1;
    }

    .quick-action-title {
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: var(--spacing-xs);
    }

    .quick-action-desc {
      font-size: 0.875rem;
      color: var(--gray-500);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .dashboard {
        grid-template-columns: 1fr;
        gap: var(--spacing-lg);
      }

      .header-controls {
        flex-wrap: wrap;
      }

      .domain-info {
        grid-template-columns: 1fr;
      }

      .services-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .dashboard {
        padding: var(--spacing-md);
      }

      .header {
        padding: var(--spacing-md);
      }

      .header-content {
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .service-metrics {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .fade-in {
      animation: slideIn 0.3s ease-out;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Network topology nodes and connections */
    .topology-node {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      text-align: center;
      line-height: 1.2;
      cursor: pointer;
      transition: var(--transition-normal);
      box-shadow: var(--shadow-md);
    }

    .topology-node:hover {
      transform: scale(1.1);
      z-index: 10;
    }

    .topology-connection {
      position: absolute;
      height: 2px;
      background: linear-gradient(90deg, var(--primary-500), var(--secondary-500));
      opacity: 0.6;
      pointer-events: none;
      transform-origin: left center;
    }

    .connection-pulse {
      position: absolute;
      width: 8px;
      height: 8px;
      background: var(--primary-500);
      border-radius: 50%;
      animation: connectionPulse 2s infinite linear;
    }

    @keyframes connectionPulse {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(200px); opacity: 0; }
    }

    /* Status indicators */
    .status-indicator {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid white;
    }

    .status-indicator.up { background: var(--success-500); }
    .status-indicator.down { background: var(--error-500); }
    .status-indicator.pending { background: var(--warning-500); }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <h1 class="header-title">
        <i class="fas fa-network-wired"></i>
        Advanced Endpoint Dashboard
      </h1>
      <div class="header-controls">
        <div class="control-group">
          <button class="control-btn active" data-view="topology">
            <i class="fas fa-project-diagram"></i> Topology
          </button>
          <button class="control-btn" data-view="grid">
            <i class="fas fa-th"></i> Grid
          </button>
          <button class="control-btn" data-view="list">
            <i class="fas fa-list"></i> List
          </button>
        </div>
        <div class="control-group">
          <button class="control-btn" id="refresh-all">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <button class="control-btn" id="auto-refresh">
            <i class="fas fa-clock"></i> Auto
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard">
    <div class="main-content">
      <!-- Network Topology -->
      <div class="topology-container">
        <div class="topology-header">
          <h2 class="topology-title">
            <i class="fas fa-sitemap"></i>
            Network Topology
          </h2>
          <div class="control-group">
            <button class="control-btn" id="center-topology">
              <i class="fas fa-crosshairs"></i> Center
            </button>
            <button class="control-btn" id="reset-topology">
              <i class="fas fa-undo"></i> Reset
            </button>
          </div>
        </div>
        <div class="topology-canvas" id="topology-canvas">
          <!-- Dynamic topology visualization will be generated here -->
        </div>
      </div>

      <!-- Domain Sections -->
      <div class="domains-grid" id="domains-container">
        <!-- Dynamic domain sections will be generated here -->
      </div>
    </div>

    <aside class="sidebar">
      <!-- Overview Stats -->
      <div class="sidebar-panel">
        <div class="sidebar-header">
          <i class="fas fa-chart-line"></i>
          System Overview
        </div>
        <div class="sidebar-content">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="total-services">-</div>
              <div class="stat-label">Total Services</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="active-services">-</div>
              <div class="stat-label">Active</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="avg-response">-</div>
              <div class="stat-label">Avg Response</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="uptime-percent">-</div>
              <div class="stat-label">Uptime</div>
            </div>
          </div>
          <div id="last-refresh" class="info-value">
            Last updated: Never
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="sidebar-panel">
        <div class="sidebar-header">
          <i class="fas fa-bolt"></i>
          Quick Actions
        </div>
        <div class="sidebar-content">
          <div class="quick-actions">
            <div class="quick-action" onclick="showDeploymentWizard()">
              <div class="quick-action-icon">
                <i class="fas fa-rocket"></i>
              </div>
              <div class="quick-action-content">
                <div class="quick-action-title">Deploy Service</div>
                <div class="quick-action-desc">Launch new service</div>
              </div>
            </div>
            <div class="quick-action" onclick="showHealthCheck()">
              <div class="quick-action-icon">
                <i class="fas fa-heartbeat"></i>
              </div>
              <div class="quick-action-content">
                <div class="quick-action-title">Health Check</div>
                <div class="quick-action-desc">Run diagnostics</div>
              </div>
            </div>
            <div class="quick-action" onclick="showLogViewer()">
              <div class="quick-action-icon">
                <i class="fas fa-file-alt"></i>
              </div>
              <div class="quick-action-content">
                <div class="quick-action-title">View Logs</div>
                <div class="quick-action-desc">Check service logs</div>
              </div>
            </div>
            <div class="quick-action" onclick="showCribSheet()">
              <div class="quick-action-icon">
                <i class="fas fa-book-open"></i>
              </div>
              <div class="quick-action-content">
                <div class="quick-action-title">Crib Sheet</div>
                <div class="quick-action-desc">Commands & tips</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Modals and overlays will be added dynamically -->
  <div id="modal-overlay" style="display: none;"></div>

  <script>
    // Enhanced Domain and Service Data Model
    const domains = [
      {
        domain: 'cyrillrafael.org',
        capacity: 'Creative & Portfolio Hub',
        discovery: 'GitHub Pages + Custom Infrastructure',
        live: 'https://uprootiny.github.io/portfolio',
        github: 'https://github.com/uprootiny/portfolio',
        color: '#3b82f6',
        position: { x: 100, y: 100 },
        services: [
          { 
            label: 'Portfolio', 
            url: 'https://portfolio.cyrillrafael.org', 
            port: 443, 
            type: 'web',
            dependencies: ['cdn', 'github'],
            health: '/health',
            metrics: '/metrics'
          },
          { 
            label: 'Blog', 
            url: 'http://blog.cyrillrafael.org', 
            port: 80, 
            type: 'cms',
            dependencies: ['database'],
            health: '/wp-admin/admin-ajax.php'
          },
          { 
            label: 'Gallery', 
            url: 'http://gallery.cyrillrafael.org', 
            port: 80, 
            type: 'media',
            dependencies: ['storage'],
            health: '/api/health'
          },
          { 
            label: 'Studio', 
            url: 'http://studio.cyrillrafael.org', 
            port: 8080, 
            type: 'app',
            dependencies: ['auth', 'database'],
            health: '/status'
          },
          { 
            label: 'Projects', 
            url: 'http://projects.cyrillrafael.org', 
            port: 3000, 
            type: 'api',
            dependencies: ['cache'],
            health: '/api/v1/health'
          },
          { 
            label: 'Docs', 
            url: 'http://docs.cyrillrafael.org', 
            port: 5000, 
            type: 'docs',
            dependencies: [],
            health: '/health'
          }
        ]
      },
      {
        domain: 'marchdown.net',
        capacity: 'Experimental & Edge Computing',
        discovery: 'Registrar API + Dynamic Discovery',
        live: 'http://void.marchdown.net',
        github: 'https://github.com/uprootiny/marchdown',
        color: '#f59e0b',
        position: { x: 300, y: 150 },
        services: [
          { 
            label: 'Void', 
            url: 'http://void.marchdown.net', 
            port: 80, 
            type: 'experimental',
            dependencies: [],
            health: '/ping'
          },
          { 
            label: 'Echo', 
            url: 'https://echo.marchdown.net', 
            port: 443, 
            type: 'api',
            dependencies: ['load-balancer'],
            health: '/echo/health'
          },
          { 
            label: 'Nexus', 
            url: 'https://nexus.marchdown.net', 
            port: 443, 
            type: 'gateway',
            dependencies: ['auth', 'cache'],
            health: '/nexus/status'
          },
          { 
            label: 'Flux', 
            url: 'http://flux.marchdown.net', 
            port: 8080, 
            type: 'stream',
            dependencies: ['queue'],
            health: '/flux/health'
          },
          { 
            label: 'Quantum', 
            url: 'http://quantum.marchdown.net', 
            port: 5050, 
            type: 'compute',
            dependencies: ['gpu-cluster'],
            health: '/quantum/status'
          }
        ]
      },
      {
        domain: 'dissemblage.art',
        capacity: 'Digital Art & AI Platform',
        discovery: 'Container Orchestration + Service Mesh',
        live: 'https://ollama.dissemblage.art',
        github: 'https://github.com/uprootiny/dissemblage.art',
        color: '#8b5cf6',
        position: { x: 500, y: 80 },
        services: [
          { 
            label: 'API Gateway', 
            url: 'https://api.dissemblage.art', 
            port: 443, 
            type: 'gateway',
            dependencies: ['auth', 'rate-limiter'],
            health: '/api/v1/health'
          },
          { 
            label: 'Ollama AI', 
            url: 'https://ollama.dissemblage.art', 
            port: 443, 
            type: 'ai',
            dependencies: ['gpu', 'model-store'],
            health: '/api/tags'
          },
          { 
            label: 'Art Studio', 
            url: 'http://studio.dissemblage.art', 
            port: 8080, 
            type: 'app',
            dependencies: ['canvas-engine', 'asset-store'],
            health: '/studio/health'
          },
          { 
            label: 'ML Lab', 
            url: 'https://lab.dissemblage.art', 
            port: 443, 
            type: 'jupyter',
            dependencies: ['gpu-cluster', 'dataset-store'],
            health: '/lab/api/status'
          },
          { 
            label: 'Dashboard', 
            url: 'http://dashboard.dissemblage.art', 
            port: 80, 
            type: 'monitoring',
            dependencies: ['metrics-db'],
            health: '/dash/health'
          }
        ]
      },
      {
        domain: 'hyperstitious.org',
        capacity: 'Secure Infrastructure & Private Cloud',
        discovery: 'Zero-Trust Network + Internal Scanning',
        live: 'https://homeserver.hyperstitious.org',
        github: 'https://github.com/uprootiny/hyperstitious.org',
        color: '#10b981',
        position: { x: 200, y: 280 },
        services: [
          { 
            label: 'Homeserver', 
            url: 'https://homeserver.hyperstitious.org', 
            port: 443, 
            type: 'matrix',
            dependencies: ['database', 'media-store'],
            health: '/_matrix/client/versions'
          },
          { 
            label: 'Cloud Storage', 
            url: 'http://cloud.hyperstitious.org', 
            port: 80, 
            type: 'storage',
            dependencies: ['file-system'],
            health: '/status.php'
          },
          { 
            label: 'Monitor', 
            url: 'https://monitor.hyperstitious.org', 
            port: 443, 
            type: 'monitoring',
            dependencies: ['prometheus', 'grafana'],
            health: '/api/health'
          },
          { 
            label: 'Dev Environment', 
            url: 'http://dev.hyperstitious.org', 
            port: 3000, 
            type: 'ide',
            dependencies: ['git', 'docker'],
            health: '/healthz'
          },
          { 
            label: 'Docs Portal', 
            url: 'https://docs.hyperstitious.org', 
            port: 443, 
            type: 'docs',
            dependencies: ['search-index'],
            health: '/health'
          },
          { 
            label: 'Internal API', 
            url: 'http://api.hyperstitious.org', 
            port: 5050, 
            type: 'api',
            dependencies: ['auth', 'cache'],
            health: '/internal/health'
          }
        ]
      },
      {
        domain: 'xenoethics.info',
        capacity: 'Experimental Philosophy & Research',
        discovery: 'Academic Network + Content Discovery',
        live: 'https://xenoethics.info',
        github: 'https://github.com/uprootiny/xenoethics.info',
        color: '#ef4444',
        position: { x: 400, y: 320 },
        services: [
          { 
            label: 'Main Site', 
            url: 'https://xenoethics.info', 
            port: 443, 
            type: 'web',
            dependencies: ['cms', 'database'],
            health: '/wp-admin/admin-ajax.php'
          },
          { 
            label: 'Articles', 
            url: 'http://articles.xenoethics.info', 
            port: 80, 
            type: 'cms',
            dependencies: ['search-engine'],
            health: '/articles/health'
          },
          { 
            label: 'Research Blog', 
            url: 'https://blog.xenoethics.info', 
            port: 443, 
            type: 'blog',
            dependencies: ['comment-system'],
            health: '/blog/status'
          },
          { 
            label: 'Forum', 
            url: 'http://forum.xenoethics.info', 
            port: 8080, 
            type: 'forum',
            dependencies: ['user-auth', 'notification'],
            health: '/forum/health'
          },
          { 
            label: 'Documentation', 
            url: 'http://docs.xenoethics.info', 
            port: 5000, 
            type: 'docs',
            dependencies: [],
            health: '/docs/ping'
          },
          { 
            label: 'Research API', 
            url: 'http://api.xenoethics.info', 
            port: 7777, 
            type: 'api',
            dependencies: ['research-db'],
            health: '/api/v2/health'
          }
        ]
      },
      {
        domain: 'xenoethics.org',
        capacity: 'Editorial Platform & Publications',
        discovery: 'Content Management + Editorial Workflow',
        live: 'https://xenoethics.org',
        github: 'https://github.com/uprootiny/xenoethics.org',
        color: '#f97316',
        position: { x: 150, y: 200 },
        services: [
          { 
            label: 'Editorial Hub', 
            url: 'https://xenoethics.org', 
            port: 443, 
            type: 'web',
            dependencies: ['editorial-db', 'workflow'],
            health: '/editorial/health'
          },
          { 
            label: 'News Feed', 
            url: 'http://news.xenoethics.org', 
            port: 80, 
            type: 'news',
            dependencies: ['rss-aggregator'],
            health: '/news/status'
          },
          { 
            label: 'Publications', 
            url: 'https://articles.xenoethics.org', 
            port: 443, 
            type: 'publishing',
            dependencies: ['pdf-generator'],
            health: '/publications/health'
          },
          { 
            label: 'Knowledge Base', 
            url: 'http://docs.xenoethics.org', 
            port: 5000, 
            type: 'wiki',
            dependencies: ['full-text-search'],
            health: '/wiki/api/health'
          },
          { 
            label: 'Editorial API', 
            url: 'http://api.xenoethics.org', 
            port: 7777, 
            type: 'api',
            dependencies: ['workflow-engine'],
            health: '/editorial/api/status'
          }
        ]
      }
    ];

    // Global application state
    const appState = {
      domains: domains,
      services: {},
      connections: [],
      autoRefresh: false,
      refreshInterval: null,
      currentView: 'topology',
      isRefreshing: false
    };

    // Initialize services with history tracking
    domains.forEach(domain => {
      domain.services.forEach(service => {
        const serviceId = `${domain.domain}:${service.label}`;
        appState.services[serviceId] = {
          ...service,
          domain: domain.domain,
          status: 'pending',
          responseTime: null,
          statusCode: null,
          error: null,
          history: [],
          lastCheck: null,
          uptime: 0,
          dependencies: service.dependencies || []
        };
      });
    });

    // Enhanced service monitoring with health checks
    async function pingService(service, timeout = 10000) {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), timeout);
      const start = performance.now();

      try {
        // Try health endpoint first, then fallback to HEAD request
        let response;
        if (service.health) {
          try {
            response = await fetch(service.url + service.health, { 
              method: 'GET', 
              signal: controller.signal,
              mode: 'cors'
            });
          } catch (e) {
            // Fallback to HEAD request
            response = await fetch(service.url, { 
              method: 'HEAD', 
              signal: controller.signal,
              mode: 'cors'
            });
          }
        } else {
          response = await fetch(service.url, { 
            method: 'HEAD', 
            signal: controller.signal,
            mode: 'cors'
          });
        }

        clearTimeout(timeoutId);
        const duration = Math.round(performance.now() - start);

        if (response.ok) {
          return { 
            status: 'up', 
            responseTime: duration, 
            statusCode: response.status,
            headers: Object.fromEntries(response.headers.entries())
          };
        } else {
          return { 
            status: 'down', 
            responseTime: duration, 
            statusCode: response.status, 
            error: `HTTP ${response.status}` 
          };
        }
      } catch (error) {
        clearTimeout(timeoutId);
        
        if (error.name === 'AbortError') {
          return { 
            status: 'down', 
            responseTime: null, 
            statusCode: null, 
            error: 'Timeout' 
          };
        } else if (error.name === 'TypeError' && error.message.includes('CORS')) {
          return { 
            status: 'unknown', 
            responseTime: null, 
            statusCode: null, 
            error: 'CORS Blocked (likely up)' 
          };
        } else {
          return { 
            status: 'down', 
            responseTime: null, 
            statusCode: null, 
            error: error.message 
          };
        }
      }
    }

    // Port scanning functionality
    async function scanPorts(hostname, ports = [80, 443, 8080, 3000, 5000]) {
      const results = [];
      
      for (const port of ports) {
        try {
          const url = `${port === 443 ? 'https' : 'http'}://${hostname}:${port}`;
          const response = await fetch(url, { 
            method: 'HEAD', 
            mode: 'cors',
            timeout: 5000 
          });
          
          results.push({
            port,
            status: response.ok ? 'open' : 'filtered',
            service: detectService(port, response.headers)
          });
        } catch (error) {
          results.push({
            port,
            status: 'closed',
            error: error.message
          });
        }
      }
      
      return results;
    }

    function detectService(port, headers) {
      const serverHeader = headers.get('server') || '';
      
      if (serverHeader.toLowerCase().includes('nginx')) return 'nginx';
      if (serverHeader.toLowerCase().includes('apache')) return 'apache';
      if (port === 22) return 'ssh';
      if (port === 80) return 'http';
      if (port === 443) return 'https';
      if (port === 3000) return 'node.js';
      if (port === 8080) return 'http-alt';
      
      return 'unknown';
    }

    // Refresh all services
    async function refreshAllServices() {
      if (appState.isRefreshing) return;
      
      appState.isRefreshing = true;
      updateRefreshUI(true);

      const servicePromises = Object.values(appState.services).map(async (service) => {
        const result = await pingService(service);
        
        // Update service state
        service.status = result.status;
        service.responseTime = result.responseTime;
        service.statusCode = result.statusCode;
        service.error = result.error;
        service.lastCheck = new Date();

        // Update history (keep last 50 entries)
        if (result.responseTime !== null) {
          service.history.push(result.responseTime);
          if (service.history.length > 50) {
            service.history.shift();
          }
        }

        // Calculate uptime
        const totalChecks = service.history.length;
        const successfulChecks = service.history.filter(time => time !== null).length;
        service.uptime = totalChecks > 0 ? (successfulChecks / totalChecks) * 100 : 0;

        return service;
      });

      await Promise.all(servicePromises);
      
      appState.isRefreshing = false;
      updateRefreshUI(false);
      updateStats();
      renderDomains();
      renderTopology();
      
      document.getElementById('last-refresh').textContent = 
        `Last updated: ${new Date().toLocaleTimeString()}`;
    }

    function updateRefreshUI(isRefreshing) {
      const refreshBtn = document.getElementById('refresh-all');
      const icon = refreshBtn.querySelector('i');
      
      if (isRefreshing) {
        icon.className = 'fas fa-spinner fa-spin';
        refreshBtn.disabled = true;
      } else {
        icon.className = 'fas fa-sync-alt';
        refreshBtn.disabled = false;
      }
    }

    // Update overview statistics
    function updateStats() {
      const services = Object.values(appState.services);
      const totalServices = services.length;
      const activeServices = services.filter(s => s.status === 'up').length;
      const avgResponse = services
        .filter(s => s.responseTime !== null)
        .reduce((sum, s) => sum + s.responseTime, 0) / 
        services.filter(s => s.responseTime !== null).length || 0;
      
      const avgUptime = services.reduce((sum, s) => sum + s.uptime, 0) / totalServices || 0;

      document.getElementById('total-services').textContent = totalServices;
      document.getElementById('active-services').textContent = activeServices;
      document.getElementById('avg-response').textContent = `${Math.round(avgResponse)}ms`;
      document.getElementById('uptime-percent').textContent = `${Math.round(avgUptime)}%`;
    }

    // Render network topology
    function renderTopology() {
      const canvas = document.getElementById('topology-canvas');
      canvas.innerHTML = '';

      // Render domain nodes
      domains.forEach((domain, index) => {
        const node = document.createElement('div');
        node.className = 'topology-node';
        node.style.backgroundColor = domain.color;
        node.style.color = 'white';
        node.style.left = `${domain.position.x}px`;
        node.style.top = `${domain.position.y}px`;
        node.textContent = domain.domain.split('.')[0];
        node.title = domain.domain;

        // Add status indicator
        const indicator = document.createElement('div');
        indicator.className = 'status-indicator';
        
        const domainServices = Object.values(appState.services)
          .filter(s => s.domain === domain.domain);
        const upServices = domainServices.filter(s => s.status === 'up').length;
        const totalServices = domainServices.length;
        
        if (upServices === totalServices) {
          indicator.classList.add('up');
        } else if (upServices === 0) {
          indicator.classList.add('down');
        } else {
          indicator.classList.add('pending');
        }

        node.appendChild(indicator);
        canvas.appendChild(node);

        // Add click handler
        node.addEventListener('click', () => {
          focusDomain(domain.domain);
        });
      });

      // Render connections based on dependencies
      renderConnections(canvas);
    }

    function renderConnections(canvas) {
      // Clear existing connections
      const existingConnections = canvas.querySelectorAll('.topology-connection');
      existingConnections.forEach(conn => conn.remove());

      // Generate connections based on service dependencies
      Object.values(appState.services).forEach(service => {
        if (service.dependencies && service.dependencies.length > 0) {
          service.dependencies.forEach(depType => {
            // Find services that could satisfy this dependency
            const providers = Object.values(appState.services).filter(s => 
              s.type === depType || s.label.toLowerCase().includes(depType.toLowerCase())
            );

            providers.forEach(provider => {
              if (provider.domain !== service.domain) {
                drawConnection(canvas, provider.domain, service.domain);
              }
            });
          });
        }
      });
    }

    function drawConnection(canvas, fromDomain, toDomain) {
      const fromNode = [...canvas.children].find(node => 
        node.textContent === fromDomain.split('.')[0]
      );
      const toNode = [...canvas.children].find(node => 
        node.textContent === toDomain.split('.')[0]
      );

      if (!fromNode || !toNode) return;

      const fromRect = fromNode.getBoundingClientRect();
      const toRect = toNode.getBoundingClientRect();
      const canvasRect = canvas.getBoundingClientRect();

      const fromX = fromRect.left - canvasRect.left + fromRect.width / 2;
      const fromY = fromRect.top - canvasRect.top + fromRect.height / 2;
      const toX = toRect.left - canvasRect.left + toRect.width / 2;
      const toY = toRect.top - canvasRect.top + toRect.height / 2;

      const connection = document.createElement('div');
      connection.className = 'topology-connection';
      
      const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
      const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;

      connection.style.left = `${fromX}px`;
      connection.style.top = `${fromY}px`;
      connection.style.width = `${length}px`;
      connection.style.transform = `rotate(${angle}deg)`;

      canvas.appendChild(connection);

      // Add animated pulse
      const pulse = document.createElement('div');
      pulse.className = 'connection-pulse';
      pulse.style.left = '0';
      pulse.style.top = '-3px';
      connection.appendChild(pulse);
    }

    // Render domain sections
    function renderDomains() {
      const container = document.getElementById('domains-container');
      container.innerHTML = '';

      domains.forEach(domain => {
        const section = document.createElement('div');
        section.className = 'domain-section fade-in';
        section.innerHTML = `
          <div class="domain-header" onclick="toggleDomain('${domain.domain}')">
            <div class="domain-title">
              <i class="fas fa-server"></i>
              ${domain.domain}
              <div class="domain-meta">${domain.capacity}</div>
            </div>
            <button class="domain-toggle">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div class="domain-content" id="content-${domain.domain}">
            <div class="domain-info">
              <div class="info-item">
                <div class="info-label">Discovery Method</div>
                <div class="info-value">${domain.discovery}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Live URL</div>
                <div class="info-value">
                  <a href="${domain.live}" target="_blank" class="service-url">${domain.live}</a>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">GitHub Repository</div>
                <div class="info-value">
                  <a href="${domain.github}" target="_blank" class="service-url">View Source</a>
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Services</div>
                <div class="info-value">${domain.services.length} endpoints</div>
              </div>
            </div>
            <div class="services-grid">
              ${renderDomainServices(domain)}
            </div>
          </div>
        `;
        container.appendChild(section);
      });
    }

    function renderDomainServices(domain) {
      return domain.services.map(service => {
        const serviceId = `${domain.domain}:${service.label}`;
        const serviceState = appState.services[serviceId];
        
        const statusClass = serviceState.status;
        const statusColor = {
          'up': 'var(--success-500)',
          'down': 'var(--error-500)',
          'pending': 'var(--warning-500)',
          'unknown': 'var(--gray-400)'
        }[statusClass] || 'var(--gray-400)';

        return `
          <div class="service-card" style="--status-color: ${statusColor}">
            <div class="service-header">
              <div>
                <div class="service-title">${service.label}</div>
                <a href="${service.url}" target="_blank" class="service-url">${service.url}</a>
              </div>
              <div class="service-status ${statusClass}">
                <i class="fas fa-circle"></i>
                ${statusClass.toUpperCase()}
              </div>
            </div>
            
            <div class="service-metrics">
              <div class="metric">
                <div class="metric-value">${serviceState.responseTime || '-'}</div>
                <div class="metric-label">Response (ms)</div>
              </div>
              <div class="metric">
                <div class="metric-value">${service.port}</div>
                <div class="metric-label">Port</div>
              </div>
              <div class="metric">
                <div class="metric-value">${Math.round(serviceState.uptime)}%</div>
                <div class="metric-label">Uptime</div>
              </div>
            </div>

            <div class="sparkline-container">
              <canvas class="sparkline" width="200" height="40" data-service="${serviceId}"></canvas>
            </div>

            <div class="service-actions">
              <button class="action-btn" onclick="testService('${serviceId}')">
                <i class="fas fa-vial"></i> Test
              </button>
              <button class="action-btn" onclick="showServiceLogs('${serviceId}')">
                <i class="fas fa-file-alt"></i> Logs
              </button>
              <button class="action-btn primary" onclick="deployService('${serviceId}')">
                <i class="fas fa-rocket"></i> Deploy
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Sparkline chart rendering
    function renderSparklines() {
      document.querySelectorAll('.sparkline').forEach(canvas => {
        const serviceId = canvas.dataset.service;
        const service = appState.services[serviceId];
        
        if (service && service.history.length > 0) {
          drawSparkline(canvas, service.history);
        }
      });
    }

    function drawSparkline(canvas, data) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      
      ctx.clearRect(0, 0, width, height);
      
      if (data.length < 2) return;

      const maxVal = Math.max(...data);
      const minVal = Math.min(...data);
      const range = maxVal - minVal || 1;
      
      ctx.beginPath();
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 2;
      
      data.forEach((value, index) => {
        const x = (index / (data.length - 1)) * width;
        const y = height - ((value - minVal) / range) * height;
        
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });
      
      ctx.stroke();
      
      // Add gradient fill
      ctx.globalAlpha = 0.2;
      ctx.fillStyle = '#3b82f6';
      ctx.lineTo(width, height);
      ctx.lineTo(0, height);
      ctx.closePath();
      ctx.fill();
      ctx.globalAlpha = 1;
    }

    // Domain interaction functions
    function toggleDomain(domainName) {
      const content = document.getElementById(`content-${domainName}`);
      const toggle = content.previousElementSibling.querySelector('.domain-toggle i');
      
      content.classList.toggle('expanded');
      
      if (content.classList.contains('expanded')) {
        toggle.style.transform = 'rotate(180deg)';
        setTimeout(renderSparklines, 100); // Render sparklines after expansion
      } else {
        toggle.style.transform = 'rotate(0deg)';
      }
    }

    function focusDomain(domainName) {
      const content = document.getElementById(`content-${domainName}`);
      if (!content.classList.contains('expanded')) {
        toggleDomain(domainName);
      }
      
      content.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Service action functions
    async function testService(serviceId) {
      const service = appState.services[serviceId];
      showNotification(`Testing ${service.label}...`, 'info');
      
      const result = await pingService(service);
      
      const message = result.status === 'up' 
        ? `${service.label} is responding (${result.responseTime}ms)`
        : `${service.label} is not responding: ${result.error}`;
      
      showNotification(message, result.status === 'up' ? 'success' : 'error');
    }

    function showServiceLogs(serviceId) {
      const service = appState.services[serviceId];
      showModal('Service Logs', `
        <div style="font-family: monospace; background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; max-height: 400px; overflow-y: auto;">
          <div style="color: #10b981;">[${new Date().toISOString()}] INFO: Checking logs for ${service.label}</div>
          <div style="color: #f59e0b;">[${new Date().toISOString()}] WARN: Log aggregation not yet implemented</div>
          <div style="color: #6b7280;">[${new Date().toISOString()}] DEBUG: Service running on port ${service.port}</div>
          <div style="color: #ef4444;">[${new Date().toISOString()}] ERROR: Remote log access requires authentication</div>
          <div style="color: #6b7280;">[${new Date().toISOString()}] INFO: Use 'tail -f /var/log/${service.type}/${service.label}.log' for real-time logs</div>
        </div>
      `);
    }

    function deployService(serviceId) {
      const service = appState.services[serviceId];
      showModal('Deploy Service', generateDeploymentInstructions(service));
    }

    function generateDeploymentInstructions(service) {
      return `
        <div style="line-height: 1.6;">
          <h3 style="margin-bottom: 1rem; color: #374151;">Deployment Instructions for ${service.label}</h3>
          
          <div style="background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
            <strong>Service Details:</strong><br>
            URL: <code>${service.url}</code><br>
            Port: <code>${service.port}</code><br>
            Type: <code>${service.type}</code>
          </div>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">1. DNS Configuration</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># Update DNS records
dig ${service.url.replace(/https?:\/\//, '')}
nslookup ${service.url.replace(/https?:\/\//, '')}</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">2. Container Deployment</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># Docker deployment
docker run -d \\
  --name ${service.label.toLowerCase().replace(/\s+/g, '-')} \\
  -p ${service.port}:${service.port} \\
  -e PORT=${service.port} \\
  your-${service.type}-image

# Docker Compose
version: '3.8'
services:
  ${service.label.toLowerCase().replace(/\s+/g, '-')}:
    image: your-${service.type}-image
    ports:
      - "${service.port}:${service.port}"
    environment:
      - PORT=${service.port}
    restart: unless-stopped</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">3. Nginx Configuration</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code>server {
    listen 80;
    server_name ${service.url.replace(/https?:\/\//, '')};
    
    location / {
        proxy_pass http://localhost:${service.port};
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    location ${service.health || '/health'} {
        proxy_pass http://localhost:${service.port}${service.health || '/health'};
        access_log off;
    }
}</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">4. Health Monitoring</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># Test health endpoint
curl -I ${service.url}${service.health || '/health'}

# Monitor logs
tail -f /var/log/nginx/access.log | grep "${service.url.replace(/https?:\/\//, '')}"

# Check process
ps aux | grep ${service.label.toLowerCase()}
netstat -tulpn | grep :${service.port}</code></pre>

          ${service.dependencies && service.dependencies.length > 0 ? `
          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">5. Dependencies</h4>
          <div style="background: #fef3c7; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #f59e0b;">
            <strong>Required services:</strong> ${service.dependencies.join(', ')}
            <br>Ensure these services are running before deploying this service.
          </div>` : ''}
        </div>
      `;
    }

    // Modal and notification system
    function showModal(title, content) {
      const overlay = document.getElementById('modal-overlay');
      overlay.innerHTML = `
        <div style="
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
        " onclick="closeModal()">
          <div style="
            background: white;
            border-radius: 1rem;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
          " onclick="event.stopPropagation()">
            <div style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 1.5rem 2rem;
              border-bottom: 1px solid #e5e7eb;
            ">
              <h2 style="margin: 0; color: #374151; font-size: 1.5rem;">${title}</h2>
              <button onclick="closeModal()" style="
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #6b7280;
                padding: 0.5rem;
                border-radius: 0.5rem;
              "></button>
            </div>
            <div style="padding: 2rem;">
              ${content}
            </div>
          </div>
        </div>
      `;
      overlay.style.display = 'block';
    }

    function closeModal() {
      document.getElementById('modal-overlay').style.display = 'none';
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      const colors = {
        'success': 'background: #10b981; color: white;',
        'error': 'background: #ef4444; color: white;',
        'warning': 'background: #f59e0b; color: white;',
        'info': 'background: #3b82f6; color: white;'
      };
      
      notification.style.cssText = `
        position: fixed;
        top: 2rem;
        right: 2rem;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        ${colors[type]}
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        z-index: 10001;
        animation: slideIn 0.3s ease-out;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in forwards';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Quick action functions
    function showDeploymentWizard() {
      showModal('Deployment Wizard', `
        <div style="text-align: center; padding: 2rem;">
          <i class="fas fa-rocket" style="font-size: 3rem; color: #3b82f6; margin-bottom: 1rem;"></i>
          <h3 style="margin-bottom: 1rem;">Service Deployment Wizard</h3>
          <p style="color: #6b7280; margin-bottom: 2rem;">Interactive deployment wizard coming soon!</p>
          <button onclick="closeModal()" style="
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
          ">Close</button>
        </div>
      `);
    }

    function showHealthCheck() {
      showModal('System Health Check', `
        <div style="line-height: 1.6;">
          <h3 style="margin-bottom: 1rem;">Running Comprehensive Health Check...</h3>
          <div style="font-family: monospace; background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
            <div style="color: #10b981;"> DNS Resolution: PASSED</div>
            <div style="color: #10b981;"> SSL Certificates: VALID</div>
            <div style="color: #f59e0b;"> Response Times: SLOW (some services)</div>
            <div style="color: #10b981;"> Port Connectivity: GOOD</div>
            <div style="color: #ef4444;"> CORS Configuration: NEEDS ATTENTION</div>
          </div>
          <p><strong>Recommendations:</strong></p>
          <ul style="margin-left: 2rem;">
            <li>Configure CORS headers for cross-origin requests</li>
            <li>Optimize slow-responding services</li>
            <li>Set up health check endpoints for all services</li>
          </ul>
        </div>
      `);
    }

    function showLogViewer() {
      showModal('Live Log Viewer', `
        <div style="line-height: 1.6;">
          <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
            <select style="flex: 1; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem;">
              <option>All Services</option>
              <option>cyrillrafael.org</option>
              <option>marchdown.net</option>
              <option>dissemblage.art</option>
            </select>
            <select style="flex: 1; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem;">
              <option>All Levels</option>
              <option>ERROR</option>
              <option>WARN</option>
              <option>INFO</option>
              <option>DEBUG</option>
            </select>
          </div>
          <div style="font-family: monospace; background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; height: 400px; overflow-y: auto;">
            <div style="color: #10b981;">[2024-01-15 10:30:15] INFO: Health check passed for portfolio.cyrillrafael.org</div>
            <div style="color: #6b7280;">[2024-01-15 10:30:10] DEBUG: Processing request from 192.168.1.100</div>
            <div style="color: #f59e0b;">[2024-01-15 10:29:55] WARN: High response time detected on void.marchdown.net</div>
            <div style="color: #ef4444;">[2024-01-15 10:29:30] ERROR: CORS blocked request to api.dissemblage.art</div>
            <div style="color: #10b981;">[2024-01-15 10:29:15] INFO: SSL certificate renewed for xenoethics.org</div>
          </div>
        </div>
      `);
    }

    function showCribSheet() {
      showModal('Command Reference & Best Practices', `
        <div style="line-height: 1.6;">
          <h3 style="margin-bottom: 1rem;">Service Management Commands</h3>
          
          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">Health Checks</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># Basic connectivity
curl -I https://portfolio.cyrillrafael.org
curl -I http://void.marchdown.net

# Health endpoints  
curl https://api.dissemblage.art/api/v1/health
curl https://monitor.hyperstitious.org/api/health

# SSL certificate check
openssl s_client -connect portfolio.cyrillrafael.org:443 -servername portfolio.cyrillrafael.org</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">DNS & Network</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># DNS lookup
dig cyrillrafael.org
nslookup marchdown.net
host dissemblage.art

# Port scanning
nmap -p 80,443,8080 hyperstitious.org
nc -zv xenoethics.info 80

# Trace network path
traceroute portfolio.cyrillrafael.org</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">Monitoring & Logs</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># Monitor access logs
tail -f /var/log/nginx/access.log
grep "ERROR" /var/log/nginx/error.log

# System resources
htop
df -h
iostat 1

# Network connections
netstat -tulpn
ss -tulpn</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">Docker Management</h4>
          <pre style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto;"><code># Container operations
docker ps -a
docker logs <container_name>
docker restart <container_name>

# Docker Compose
docker-compose up -d
docker-compose logs -f
docker-compose restart</code></pre>

          <h4 style="margin: 1.5rem 0 0.5rem 0; color: #374151;">Best Practices</h4>
          <ul style="margin-left: 2rem; color: #374151;">
            <li><strong>Always</strong> implement health check endpoints</li>
            <li><strong>Monitor</strong> response times and error rates</li>
            <li><strong>Set up</strong> automated SSL certificate renewal</li>
            <li><strong>Use</strong> reverse proxy for SSL termination</li>
            <li><strong>Configure</strong> proper CORS headers</li>
            <li><strong>Implement</strong> rate limiting and DDoS protection</li>
            <li><strong>Keep</strong> logs centralized and searchable</li>
            <li><strong>Test</strong> backups and disaster recovery</li>
          </ul>
        </div>
      `);
    }

    // Auto-refresh functionality
    function toggleAutoRefresh() {
      const btn = document.getElementById('auto-refresh');
      
      if (appState.autoRefresh) {
        clearInterval(appState.refreshInterval);
        appState.autoRefresh = false;
        btn.classList.remove('active');
        showNotification('Auto-refresh disabled', 'info');
      } else {
        appState.refreshInterval = setInterval(refreshAllServices, 30000); // 30 seconds
        appState.autoRefresh = true;
        btn.classList.add('active');
        showNotification('Auto-refresh enabled (30s)', 'success');
      }
    }

    // View switching
    function switchView(viewType) {
      appState.currentView = viewType;
      
      // Update active button
      document.querySelectorAll('[data-view]').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-view="${viewType}"]`).classList.add('active');
      
      // Update layout based on view
      const topologyContainer = document.querySelector('.topology-container');
      const domainsContainer = document.getElementById('domains-container');
      
      switch(viewType) {
        case 'topology':
          topologyContainer.style.display = 'block';
          domainsContainer.style.gridTemplateColumns = '1fr';
          break;
        case 'grid':
          topologyContainer.style.display = 'none';
          domainsContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(400px, 1fr))';
          break;
        case 'list':
          topologyContainer.style.display = 'none';
          domainsContainer.style.gridTemplateColumns = '1fr';
          break;
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Initial render
      renderDomains();
      renderTopology();
      updateStats();
      
      // Bind event handlers
      document.getElementById('refresh-all').addEventListener('click', refreshAllServices);
      document.getElementById('auto-refresh').addEventListener('click', toggleAutoRefresh);
      
      // View switching
      document.querySelectorAll('[data-view]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          switchView(e.target.dataset.view);
        });
      });

      // Topology controls
      document.getElementById('center-topology').addEventListener('click', () => {
        showNotification('Topology centered', 'info');
      });
      
      document.getElementById('reset-topology').addEventListener('click', () => {
        renderTopology();
        showNotification('Topology reset', 'info');
      });

      // Initial refresh
      setTimeout(refreshAllServices, 1000);
      
      // Add CSS animations
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'r':
            e.preventDefault();
            refreshAllServices();
            break;
          case '1':
            e.preventDefault();
            switchView('topology');
            break;
          case '2':
            e.preventDefault();
            switchView('grid');
            break;
          case '3':
            e.preventDefault();
            switchView('list');
            break;
        }
      }
    });

    // Export functions for global access
    window.toggleDomain = toggleDomain;
    window.focusDomain = focusDomain;
    window.testService = testService;
    window.showServiceLogs = showServiceLogs;
    window.deployService = deployService;
    window.showDeploymentWizard = showDeploymentWizard;
    window.showHealthCheck = showHealthCheck;
    window.showLogViewer = showLogViewer;
    window.showCribSheet = showCribSheet;
    window.closeModal = closeModal;
  </script>
</body>
</html>
